<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scanner Map</title>

  <!-- Leaflet Core -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

  <!-- Other Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
  <script src="https://unpkg.com/wavesurfer.js"></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />

  <!-- Inline Styles -->
  <style>
    .center-controls {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .search-heatmap-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #search-input {
      flex: 1;
      min-width: 200px;
      max-width: 300px;
    }

    .heatmap-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      white-space: nowrap;
    }

    #heatmap-intensity-container {
      min-width: 100px;
      margin-left: 10px;
    }

    .sessions-list {
      max-height: 400px;
      overflow-y: auto;
      margin: 15px 0;
    }

    .session-item {
      padding: 12px;
      margin-bottom: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: var(--background-color);
    }

    .session-info {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .session-details {
      flex-grow: 1;
      padding-right: 15px;
    }

    .session-actions {
      display: flex;
      gap: 10px;
    }

    .terminate-session-btn {
      background-color: #330000;
      color: #ff0000;
      border: 1px solid #ff0000;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 4px;
      font-family: 'Share Tech Mono', monospace;
      transition: all 0.3s;
    }

    .terminate-session-btn:hover {
      background-color: #ff0000;
      color: var(--background-color);
      box-shadow: 0 0 10px #ff0000;
    }

    .current-session {
      border: 1px solid var(--primary-color);
      box-shadow: 0 0 5px var(--primary-color);
    }

    .device-info {
      margin-top: 8px;
      font-size: 0.9em;
      opacity: 0.8;
    }

    .user-selection {
      margin-bottom: 15px;
    }

    .user-selection label {
      margin-right: 10px;
      font-weight: bold;
    }

    @media screen and (max-width: 768px) {
      .search-heatmap-container {
        flex-direction: column;
        width: 100%;
        align-items: stretch;
      }

      #search-input {
        width: 100%;
        max-width: none;
        margin-bottom: 10px;
      }

      .heatmap-controls {
        width: 100%;
        justify-content: space-between;
        flex-wrap: wrap;
      }

      #heatmap-intensity-container {
        width: 100%;
        margin-left: 0;
        margin-top: 5px;
      }

      .session-info {
        flex-direction: column;
      }

      .session-actions {
        margin-top: 10px;
        width: 100%;
        justify-content: flex-end;
      }

      .session-details {
        padding-right: 0;
      }
    }

    /* Styles for Global Volume Control */
    .global-volume-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px; /* Add space below heatmap controls */
      width: 100%; /* Take full width in its container */
      justify-content: center; /* Center items */
    }

    .global-volume-controls label {
      font-size: 14px;
      color: var(--text-color);
      white-space: nowrap;
    }

    #global-volume {
      width: 100%;
      max-width: 200px; /* Limit slider width */
      height: 8px;
    }

    /* Adjust global volume layout for mobile */
    .global-volume-controls {
      margin-top: 5px;
      padding: 0 5px; /* Add padding */
    }
    .global-volume-controls label {
      font-size: 12px; /* Smaller label */
    }
    #global-volume {
      max-width: 150px; /* Shorter slider on mobile */
    }

    /* --- Live Feed Display Styles --- */
    #live-feed-display {
      position: fixed;
      bottom: 200px; /* Adjust based on control panel height, especially mobile */
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 500px;
      max-height: 150px; /* Approx 5 lines */
      background-color: rgba(0, 0, 0, 0.85);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
      z-index: 997; /* Below control panel/modals, above map */
      overflow: hidden; /* Prevent scrollbars */
      display: flex;
      flex-direction: column-reverse; /* Newest items appear at the bottom and push upwards */
      padding: 5px;
      box-sizing: border-box;
      pointer-events: none; /* Allow clicks to pass through to map */
      transition: bottom 0.3s ease-in-out; /* For mobile positioning */
    }

    .live-feed-item {
      padding: 4px 8px;
      margin-bottom: 3px; /* Space between items */
      font-family: 'Share Tech Mono', monospace;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      background-color: rgba(0, 20, 0, 0.7); /* Slight background */
      border-radius: 3px;
      opacity: 1;
      transition: opacity 1.5s ease-out; /* Slower fade out */
      border-left: 2px solid var(--primary-color); /* Indicator */
    }

    .live-feed-item.fading-out {
      opacity: 0;
    }

    .live-feed-item strong {
        color: #00ccff; /* Highlight talkgroup name */
        margin-right: 5px;
    }

    /* Mobile adjustment for live feed display position */
    @media screen and (max-width: 768px) {
        #live-feed-display {
            bottom: 190px; /* Position above the taller mobile control panel */
            max-width: calc(100% - 20px); /* Adjust width for mobile */
            max-height: 120px; /* Slightly shorter on mobile */
        }
        .live-feed-item {
            font-size: 12px; /* Smaller font on mobile */
        }
    }
    @media screen and (max-width: 480px) {
        #live-feed-display {
           bottom: 190px; /* May need further adjustment if control panel grows */
        }
    }
    /* --- END Live Feed Display Styles --- */

    /* --- Live Feed Setup Modal Styles --- */
    .live-feed-modal-content {
      width: 90%;
      max-width: 500px; /* Adjust width as needed */
      max-height: 85vh; /* Limit height */
      display: flex;
      flex-direction: column;
    }

    .live-feed-modal-content h2 {
      text-align: center;
      margin-bottom: 15px;
      text-shadow: 0 0 8px var(--primary-color);
    }

    #live-feed-search {
        width: 100%;
        padding: 8px 10px;
        background-color: #000;
        color: #00ff00;
        border: 1px solid #00ff00;
        border-radius: 4px;
        font-family: 'Share Tech Mono', monospace;
        font-size: 14px;
        box-sizing: border-box;
        margin-bottom: 15px;
    }

    .live-feed-master-controls {
        display: flex;
        justify-content: space-around;
        padding: 10px 0;
        margin-bottom: 15px;
        border-top: 1px solid rgba(0, 255, 0, 0.2);
        border-bottom: 1px solid rgba(0, 255, 0, 0.2);
    }

    .live-feed-master-controls label {
        display: inline-flex;
        align-items: center;
        cursor: pointer;
        font-size: 14px;
        color: var(--text-color);
    }

    .live-feed-master-controls input[type="checkbox"] {
        margin-right: 8px;
        accent-color: var(--primary-color);
        width: 16px;
        height: 16px;
    }

    #live-feed-talkgroup-list {
      flex-grow: 1; /* Allow list to take available space */
      overflow-y: auto; /* Enable scrolling */
      padding-right: 10px; /* Space for scrollbar */
      margin-bottom: 15px;
      border: 1px solid rgba(0, 255, 0, 0.2);
      padding: 5px;
      min-height: 200px; /* Ensure it has some height */
    }

    /* Scrollbar for talkgroup list */
    #live-feed-talkgroup-list::-webkit-scrollbar {
      width: 10px;
    }

    #live-feed-talkgroup-list::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 5px;
    }

    #live-feed-talkgroup-list::-webkit-scrollbar-thumb {
      background-color: var(--primary-color);
      border-radius: 5px;
      border: 2px solid rgba(0, 0, 0, 0.3);
    }

    #live-feed-talkgroup-list {
      scrollbar-width: thin;
      scrollbar-color: var(--primary-color) rgba(0, 0, 0, 0.3);
    }

    .live-feed-tg-item {
      display: flex;
      align-items: center;
      padding: 8px 5px;
      margin-bottom: 3px;
      border-radius: 3px;
      transition: background-color 0.2s;
      cursor: pointer;
    }

    .live-feed-tg-item:hover {
        background-color: rgba(0, 51, 0, 0.2);
    }

    .live-feed-tg-item input[type="checkbox"] {
        margin-right: 10px;
        accent-color: var(--primary-color);
        flex-shrink: 0;
        width: 15px;
        height: 15px;
    }

    .live-feed-tg-item label {
        font-size: 14px;
        color: var(--text-color);
        flex-grow: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    /* --- END Live Feed Setup Modal Styles --- */

    /* Google Places Autocomplete Styling */
    .pac-container {
      background-color: #000 !important;
      border: 1px solid #00ff00 !important;
      border-radius: 4px !important;
      box-shadow: 0 0 10px rgba(0, 255, 0, 0.3) !important;
      font-family: 'Share Tech Mono', monospace !important;
    }

    .pac-item {
      background-color: #000 !important;
      color: #00ff00 !important;
      border: none !important;
      padding: 8px 12px !important;
      cursor: pointer !important;
    }

    .pac-item:hover {
      background-color: rgba(0, 255, 0, 0.1) !important;
    }

    .pac-item-selected {
      background-color: rgba(0, 255, 0, 0.2) !important;
    }

    .pac-item-query {
      color: #00ff00 !important;
      font-weight: bold !important;
    }

    .pac-matched {
      color: #00ccff !important;
    }

    .pac-icon {
      filter: invert(1) hue-rotate(120deg) brightness(1.5) !important;
    }
  </style>
</head>

<body>
  <button id="sidebar-toggle-btn" aria-label="Toggle Category Sidebar">‚ò∞ Categories</button>
  <div id="map"></div>

  <div id="category-sidebar">
    <div class="category-header">Categories</div>
    <div id="category-list"></div>
  </div>

  <div id="control-panel">
     <div class="left-controls">
      <select id="time-filter">
        <option value="1">Last 1 hour</option>
        <option value="3">Last 3 hours</option>
        <option value="6">Last 6 hours</option>
        <option value="12" selected>Last 12 hours</option>
        <option value="24">Last 24 hours</option>
        <option value="48">Last 2 days</option>
        <option value="168">Last 7 days</option>
        <option value="custom">Custom range</option>
      </select>
      <button id="toggle-mode">Day/Night</button>
      <button id="live-feed-setup-btn">Live Feed</button>
      </div>

    <div id="new-call-banner" class="hidden">
      New call from: <span id="talkgroup-name"></span><span class="ellipsis"></span>
    </div>

    <div class="center-controls">
      <div class="search-heatmap-container">
        <input type="text" id="search-input" placeholder="Search Calls..." />
        <div class="heatmap-controls">
          <label for="enable-heatmap">
            <input type="checkbox" id="enable-heatmap" />
            Enable Heatmap
          </label>
          <div id="heatmap-intensity-container">
            <input type="range" id="heatmap-intensity" min="1" max="10" value="5" />
          </div>
          <div id="global-volume-container" class="global-volume-controls">
            <label for="global-volume">Volume:</label>
            <input type="range" id="global-volume" class="volume" min="0" max="1" step="0.05" value="0.5" />
          </div>
        </div>
      </div>
    </div>

    <div class="right-controls">
      <div class="controls-checkbox-group">
        <label for="mute-new-calls">
          <input type="checkbox" id="mute-new-calls" />
          Mute New Calls
        </label>
        <label for="track-new-calls">
          <input type="checkbox" id="track-new-calls" checked />
          Track New Calls
        </label>
      </div>
      <div class="user-management-dropdown">
        <button id="user-menu-btn" class="cyberpunk-button">Settings</button>
        <div id="user-menu-content" class="dropdown-content">
          <a href="#" id="settings-btn">‚öôÔ∏è Settings</a>
          <hr style="margin: 5px 0; border-color: var(--border-color);">
          <a href="#" id="setup-wizard-btn">ü™Ñ Setup Wizard</a>
          <a href="#" id="service-config-btn">üîß Service Configuration</a>
          <hr style="margin: 5px 0; border-color: var(--border-color);">
          <a href="#" id="add-user-btn">üë§ Add User</a>
          <a href="#" id="view-users-btn">üë• View Users</a>
          <a href="#" id="manage-sessions-btn">üîê Manage Sessions</a>
          <hr style="margin: 5px 0; border-color: var(--border-color);">
          <a href="#" id="call-purge-btn">üóëÔ∏è Call Purge</a>
        </div>
      </div>
    </div>
     </div>

  <div id="summary-bar">
    <div class="ticker-wrap"><div class="ticker"></div></div>
  </div>
<div id="custom-time-modal" class="modal">
    <div class="modal-content">
      <h2>Select Custom Time Range</h2>
      <div class="form-group"><label>Start Date:</label><input type="date" id="custom-start-date" /></div>
      <div class="form-group"><label>Start Time:</label><input type="time" id="custom-start-time" /></div>
      <div class="form-group"><label>End Date:</label><input type="date" id="custom-end-date" /></div>
      <div class="form-group"><label>End Time:</label><input type="time" id="custom-end-time" /></div>
      <div class="modal-buttons">
        <button onclick="applyCustomTimeFilter()" class="confirm-btn">Apply</button>
        <button type="button" class="cancel-btn" onclick="document.getElementById('custom-time-modal').style.display='none'">Cancel</button>
      </div>
    </div>
  </div>

  <div id="add-user-modal" class="modal">
    <div class="modal-content">
      <h2>Add New User</h2>
      <form id="add-user-form">
        <div class="form-group"><label>Username:</label><input type="text" id="new-username" required /></div>
        <div class="form-group"><label>Password:</label><input type="password" id="new-password" required /></div>
        <div class="modal-buttons">
          <button type="submit" class="confirm-btn">Add User</button>
          <button type="button" class="cancel-btn" onclick="document.getElementById('add-user-modal').style.display='none'">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <div id="view-users-modal" class="modal">
    <div class="modal-content">
      <h2>Manage Users</h2>
      <div id="users-list" class="users-list">Loading...</div>
      <div class="modal-buttons">
          <button type="button" class="cancel-btn" onclick="document.getElementById('view-users-modal').style.display='none'">Close</button>
        </div>
    </div>
  </div>

  <div id="sessions-modal" class="modal">
    <div class="modal-content">
      <h2>Active Sessions</h2>
      <div class="user-selection">
        <label for="user-dropdown">Select User:</label>
        <select id="user-dropdown" class="styled-select"></select>
      </div>
      <div id="sessions-list" class="sessions-list">Loading...</div>
      <div class="modal-buttons">
          <button type="button" class="cancel-btn" onclick="document.getElementById('sessions-modal').style.display='none'">Close</button>
        </div>
    </div>
  </div>

  <!-- Call Purge Modal -->
  <div id="call-purge-modal" class="modal">
    <div class="modal-content call-purge-modal-content">
      <h2>Call Purge</h2>
      <p class="purge-description">Remove calls from the map while preserving all call information. Selected calls will no longer appear on the map but remain in the database.</p>
      
      <div class="form-group">
        <label for="purge-talkgroup-search">Search Talkgroups:</label>
        <input type="text" id="purge-talkgroup-search" placeholder="Start typing..." />
      </div>
      
      <div id="purge-talkgroup-list" class="purge-talkgroup-list">
        <div class="loading-placeholder">Loading talkgroups...</div>
      </div>
      
      <div class="form-group">
        <label for="purge-category-select">Category:</label>
        <select id="purge-category-select" class="styled-select">
          <option value="">All Categories</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Time Range:</label>
        <div class="time-range-options">
          <button type="button" class="time-preset-btn" data-hours="1">Last 1 hour</button>
          <button type="button" class="time-preset-btn" data-hours="3">Last 3 hours</button>
          <button type="button" class="time-preset-btn" data-hours="6">Last 6 hours</button>
          <button type="button" class="time-preset-btn" data-hours="12">Last 12 hours</button>
          <button type="button" class="time-preset-btn" data-hours="24">Last 24 hours</button>
          <button type="button" class="time-preset-btn" data-hours="48">Last 2 days</button>
          <button type="button" class="time-preset-btn" data-hours="168">Last 7 days</button>
        </div>
        <div class="custom-time-section">
          <label for="purge-custom-time-toggle">
            <input type="checkbox" id="purge-custom-time-toggle" />
            Custom Time Range
          </label>
          <div id="purge-custom-time-inputs" class="custom-time-inputs" style="display: none;">
            <div class="time-input-row">
              <div class="time-input-group">
                <label for="purge-start-date">Start Date:</label>
                <input type="date" id="purge-start-date" />
              </div>
              <div class="time-input-group">
                <label for="purge-start-time">Start Time:</label>
                <input type="time" id="purge-start-time" />
              </div>
            </div>
            <div class="time-input-row">
              <div class="time-input-group">
                <label for="purge-end-date">End Date:</label>
                <input type="date" id="purge-end-date" />
              </div>
              <div class="time-input-group">
                <label for="purge-end-time">End Time:</label>
                <input type="time" id="purge-end-time" />
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-buttons">
        <button type="button" id="purge-confirm-btn" class="confirm-btn">Purge Calls</button>
        <button type="button" id="undo-last-purge-btn" class="undo-btn" style="display: none;">Undo Last Purge</button>
        <button type="button" class="cancel-btn" onclick="document.getElementById('call-purge-modal').style.display='none'">Cancel</button>
      </div>
    </div>
  </div>
  <!-- END Call Purge Modal -->
  
  <!-- Call Purge Confirmation Modal -->
  <div id="purge-confirmation-modal" class="modal">
    <div class="modal-content confirmation-modal-content">
      <h2>Confirm Call Purge</h2>
      <div id="purge-confirmation-message" class="confirmation-message">
        <!-- Message will be populated by JavaScript -->
      </div>
      <div class="modal-buttons">
        <button type="button" id="purge-confirm-yes" class="confirm-btn">Yes, Purge Calls</button>
        <button type="button" id="purge-confirm-no" class="cancel-btn">Cancel</button>
      </div>
    </div>
  </div>
  <!-- END Call Purge Confirmation Modal -->
  
  <div id="audio-container" style="display: none;"></div>

  <!-- Talkgroup History Modal -->
  <div id="talkgroup-modal" class="modal">
    <div class="modal-content talkgroup-modal-content">
      <h2 id="talkgroup-modal-title">Talkgroup History</h2>

      <!-- Autoplay Toggle -->
      <div class="talkgroup-modal-controls">
        <label for="talkgroup-autoplay-toggle" id="talkgroup-autoplay-label">
          <input type="checkbox" id="talkgroup-autoplay-toggle" />
          <span>Autoplay New Calls</span>
        </label>
      </div>
      <!-- End Autoplay Toggle -->

      <div id="talkgroup-list" class="talkgroup-list">
        <!-- Transcription items will be loaded here -->
        <div class="loading-placeholder">Loading history...</div>
      </div>
      <div class="modal-buttons">
        <button type="button" class="cancel-btn" onclick="closeTalkgroupModal()">Close</button>
      </div>
    </div>
  </div>
  <!-- END Talkgroup History Modal -->

  <!-- NEW: Live Feed Setup Modal -->
  <div id="live-feed-modal" class="modal">
      <div class="modal-content live-feed-modal-content">
          <h2>Live Feed Setup</h2>

          <div class="form-group">
              <label for="live-feed-search">Search Talkgroups:</label>
              <input type="text" id="live-feed-search" placeholder="Start typing..." />
          </div>

          <div class="live-feed-master-controls">
              <!-- REMOVED AUDIO ENABLE CHECKBOX -->
              <!--
              <label>
                  <input type="checkbox" id="live-feed-audio-enable" />
                  Enable Live Audio
              </label>
              -->
          </div>

          <div id="live-feed-talkgroup-list">
              <div class="loading-placeholder">Loading talkgroups...</div>
          </div>

          <div class="modal-buttons">
              <button type="button" class="cancel-btn" onclick="closeLiveFeedModal()">Close</button>
          </div>
      </div>
  </div>
  <!-- END Live Feed Setup Modal -->

  <!-- NEW: Live Feed Display Area -->
  <div id="live-feed-display">
  </div>
  <!-- END Live Feed Display Area -->

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal">
    <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
      <h2>Settings</h2>
      
      <div class="settings-tabs">
        <button class="settings-tab active" data-tab="general">General</button>
        <button class="settings-tab" data-tab="services">Services</button>
        <button class="settings-tab" data-tab="models">Models</button>
        <button class="settings-tab" data-tab="map">Map</button>
        <button class="settings-tab" data-tab="audio">Audio</button>
        <button class="settings-tab" data-tab="geocoding">Geocoding</button>
        <button class="settings-tab" data-tab="transcription">Transcription</button>
        <button class="settings-tab" data-tab="ai">AI</button>
        <button class="settings-tab" data-tab="discord">Discord</button>
        <button class="settings-tab" data-tab="storage">Storage</button>
        <button class="settings-tab" data-tab="display">Display</button>
        <button class="settings-tab" data-tab="api-keys">API Keys</button>
        <button class="settings-tab" data-tab="logs">Logs</button>
      </div>
      
      <!-- General Settings Tab -->
      <div id="settings-general-tab" class="settings-tab-content active">
        <h3>General Settings</h3>
        <div class="form-group">
          <label for="settings-webserver-port">Web Server Port:</label>
          <input type="number" id="settings-webserver-port" min="1" max="65535" />
          <small>Port for the web interface (default: 3001)</small>
        </div>
        <div class="form-group">
          <label for="settings-bot-port">API Port:</label>
          <input type="number" id="settings-bot-port" min="1" max="65535" />
          <small>Port for radio software uploads (default: 3306)</small>
        </div>
        <div class="form-group">
          <label for="settings-public-domain">Public Domain:</label>
          <input type="text" id="settings-public-domain" placeholder="localhost or your-domain.com" />
          <small>Domain for audio playback URLs</small>
        </div>
        <div class="form-group">
          <label for="settings-timezone">Timezone:</label>
          <select id="settings-timezone" class="styled-select">
            <option value="America/New_York">America/New_York (EST/EDT)</option>
            <option value="America/Chicago">America/Chicago (CST/CDT)</option>
            <option value="America/Denver">America/Denver (MST/MDT)</option>
            <option value="America/Los_Angeles">America/Los_Angeles (PST/PDT)</option>
            <option value="UTC">UTC</option>
            <!-- More timezones can be added -->
          </select>
          <small>Timezone for timestamps</small>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="settings-auth-enabled" />
            Enable Authentication
          </label>
          <small>Require login to access the web interface</small>
        </div>
        <div class="modal-buttons">
          <button type="button" id="save-general-settings-btn" class="confirm-btn">Save General Settings</button>
        </div>
      </div>
      
      <!-- Services Settings Tab -->
      <div id="settings-services-tab" class="settings-tab-content">
        <h3>Service Configuration & Status</h3>
        <p class="config-description">Configure service URLs and monitor service status. URLs are auto-detected based on your environment.</p>
        
        <!-- Service Status Display -->
        <div style="margin-bottom: 15px; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; background-color: rgba(0, 51, 0, 0.2);">
          <h4 style="margin-top: 0;">Service Status</h4>
          <div id="settings-service-status-content">Loading service status...</div>
          <button type="button" class="install-btn" onclick="loadSettingsServiceStatus()" style="margin-top: 10px;">Refresh Status</button>
        </div>
        
        <!-- Ollama Configuration -->
        <div style="margin-bottom: 15px; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4 style="margin-top: 0;">ü§ñ Ollama (AI Service)</h4>
          <div class="form-group">
            <label for="settings-services-ollama-url">Ollama URL:</label>
            <input type="text" id="settings-services-ollama-url" placeholder="Auto-detected or enter custom URL" />
            <small>Leave empty for auto-detection. Use <code>http://ollama:11434</code> for Docker-to-Docker, <code>http://localhost:11434</code> for Local-to-Docker or Local-to-Local</small>
            <button type="button" class="install-btn" onclick="autoDetectServiceUrl('ollama', 11434, 'settings-services-ollama-url')" style="margin-top: 5px;">Auto-Detect</button>
          </div>
          <div class="form-group">
            <label for="settings-services-ollama-model">Model Name:</label>
            <input type="text" id="settings-services-ollama-model" placeholder="llama3.1:8b" />
            <small>Model to use for AI tasks (see Models tab for recommendations)</small>
          </div>
        </div>
        
        <!-- iCAD Transcribe Configuration -->
        <div style="margin-bottom: 15px; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4 style="margin-top: 0;">üö® iCAD Transcribe (Transcription Service)</h4>
          <div class="form-group">
            <label for="settings-services-icad-url">iCAD Transcribe URL:</label>
            <input type="text" id="settings-services-icad-url" placeholder="Auto-detected or enter custom URL" />
            <small>Leave empty for auto-detection. Use <code>http://icad-transcribe:9912</code> for Docker-to-Docker, <code>http://localhost:9912</code> for Local-to-Docker or Local-to-Local</small>
            <button type="button" class="install-btn" onclick="autoDetectServiceUrl('icad-transcribe', 9912, 'settings-services-icad-url')" style="margin-top: 5px;">Auto-Detect</button>
          </div>
          <div class="form-group">
            <label for="settings-services-icad-api-key">API Key:</label>
            <input type="password" id="settings-services-icad-api-key" placeholder="Enter API key" />
            <small>API key for iCAD Transcribe (auto-generated if using Docker)</small>
          </div>
        </div>
        
        <div class="modal-buttons" style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button type="button" id="external-services-action-btn" class="confirm-btn" style="flex: 1; min-width: 200px;">
            <span id="external-services-action-text">Configure & Launch Services</span>
          </button>
          <button type="button" id="save-services-settings-btn" class="confirm-btn" style="flex: 1; min-width: 200px;">Save Service Configuration</button>
        </div>
      </div>
      
      <!-- Models Settings Tab -->
      <div id="settings-models-tab" class="settings-tab-content">
        <h3>AI Model Management</h3>
        <p class="config-description">View recommended models for your hardware and manage installed models. Optimized for public safety use cases.</p>
        
        <!-- Hardware Info -->
        <div style="margin-bottom: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px; background-color: rgba(0, 51, 0, 0.2);">
          <h4 style="margin-top: 0;">Hardware Information</h4>
          <div id="settings-hardware-info">Loading hardware information...</div>
        </div>
        
        <!-- Model Recommendations -->
        <div style="margin-bottom: 25px;">
          <h4>Recommended Models</h4>
          <div id="settings-model-recommendations-content">Loading recommendations...</div>
        </div>
        
        <!-- Installed Models -->
        <div style="margin-bottom: 25px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4 style="margin-top: 0;">Installed Models</h4>
          <div id="settings-installed-models-content">Loading installed models...</div>
          <button type="button" class="install-btn" onclick="loadSettingsInstalledModels()" style="margin-top: 10px;">Refresh Model List</button>
        </div>
        
        <!-- Manual Model Pull -->
        <div style="margin-bottom: 25px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4 style="margin-top: 0;">Pull Model</h4>
          <div class="form-group">
            <label for="settings-pull-model-name">Model Name:</label>
            <input type="text" id="settings-pull-model-name" placeholder="e.g., llama3.1:8b, mistral:7b" />
            <small>Enter the full model name to pull from Ollama</small>
          </div>
          <button type="button" class="confirm-btn" onclick="pullModelFromSettings()">Pull Model</button>
          <div id="settings-pull-model-status" style="margin-top: 10px;"></div>
        </div>
      </div>
      
      <!-- Map Settings Tab -->
      <div id="settings-map-tab" class="settings-tab-content">
        <h3>Map Settings</h3>
        <div class="form-group">
          <label for="settings-map-center-lat">Default Center Latitude:</label>
          <input type="number" id="settings-map-center-lat" step="0.000001" />
          <small>Default map center latitude</small>
        </div>
        <div class="form-group">
          <label for="settings-map-center-lng">Default Center Longitude:</label>
          <input type="number" id="settings-map-center-lng" step="0.000001" />
          <small>Default map center longitude</small>
        </div>
        <div class="form-group">
          <label for="settings-map-zoom">Default Zoom Level:</label>
          <input type="number" id="settings-map-zoom" min="1" max="18" />
          <small>Initial map zoom level (1-18)</small>
        </div>
        <div class="form-group">
          <label for="settings-default-time-range">Default Time Range (hours):</label>
          <input type="number" id="settings-default-time-range" min="1" max="168" />
          <small>Default time range for displaying calls (1-168 hours)</small>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="settings-track-new-calls" checked />
            Track New Calls Automatically
          </label>
          <small>Automatically zoom to new calls when they arrive</small>
        </div>
        <div class="modal-buttons">
          <button type="button" id="save-map-settings-btn" class="confirm-btn">Save Map Settings</button>
        </div>
      </div>
      
      <!-- Audio Settings Tab -->
      <div id="settings-audio-tab" class="settings-tab-content">
        <h3>Audio Settings</h3>
        <div class="form-group">
          <label for="settings-global-volume">Global Volume:</label>
          <input type="range" id="settings-global-volume" min="0" max="1" step="0.05" value="0.5" />
          <span id="settings-volume-display">50%</span>
          <small>Default volume for all audio playback</small>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="settings-mute-new-calls" />
            Mute New Calls by Default
          </label>
          <small>New calls won't play audio automatically</small>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="settings-autoplay-enabled" />
            Enable Autoplay
          </label>
          <small>Automatically play audio for new calls (if not muted)</small>
        </div>
        <div class="modal-buttons">
          <button type="button" id="save-audio-settings-btn" class="confirm-btn">Save Audio Settings</button>
        </div>
      </div>
      
      <!-- Geocoding Settings Tab -->
      <div id="settings-geocoding-tab" class="settings-tab-content">
        <h3>Geocoding Settings</h3>
        <div class="form-group">
          <label for="settings-geocoding-provider">Geocoding Provider:</label>
          <select id="settings-geocoding-provider" class="styled-select">
            <option value="nominatim">Nominatim (Free)</option>
            <option value="google">Google Maps</option>
            <option value="locationiq">LocationIQ</option>
            <option value="auto">Auto (Use Available)</option>
          </select>
          <small>Provider for address geocoding</small>
        </div>
        <div class="form-group">
          <label for="settings-geocoding-city">Default City:</label>
          <input type="text" id="settings-geocoding-city" />
          <small>Default city for geocoding bias</small>
        </div>
        <div class="form-group">
          <label for="settings-geocoding-state">Default State/Province:</label>
          <input type="text" id="settings-geocoding-state" />
          <small>Default state for geocoding bias</small>
        </div>
        <div class="form-group">
          <label for="settings-geocoding-country">Default Country:</label>
          <input type="text" id="settings-geocoding-country" placeholder="us" />
          <small>Default country code (e.g., us, ca, uk)</small>
        </div>
        <div class="form-group">
          <label for="settings-geocoding-counties">Target Counties:</label>
          <input type="text" id="settings-geocoding-counties" placeholder="County1, County2, County3" />
          <small>Comma-separated list of target counties</small>
        </div>
        <div class="modal-buttons">
          <button type="button" id="save-geocoding-settings-btn" class="confirm-btn">Save Geocoding Settings</button>
        </div>
      </div>
      
      <!-- Transcription Settings Tab -->
      <div id="settings-transcription-tab" class="settings-tab-content">
        <h3>Transcription Settings</h3>
        <p class="config-description">Select one transcription service. Only one can be enabled at a time.</p>
        <div class="form-group">
          <label for="settings-transcription-mode-select">Transcription Service:</label>
          <select id="settings-transcription-mode-select" class="styled-select" style="width: 100%;">
            <option value="local">Local (Whisper) - Built-in Whisper transcription (no external service)</option>
            <option value="icad">iCAD Transcribe - Advanced transcription with web UI</option>
            <option value="openai">OpenAI Whisper API - Cloud-based transcription via OpenAI</option>
            <option value="faster-whisper">Faster-Whisper Server - Remote Faster-Whisper server</option>
          </select>
          <input type="hidden" id="settings-transcription-mode" />
        </div>
        <div id="transcription-icad-settings" style="display: none; margin-top: 10px; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; background-color: rgba(0, 51, 0, 0.2);">
          <h4 style="margin-top: 0;">iCAD Transcribe Configuration</h4>
          <div class="form-group">
            <label for="settings-icad-url">iCAD Transcribe URL:</label>
            <input type="text" id="settings-icad-url" placeholder="Auto-detected or enter custom URL" />
            <small>URL is auto-detected based on your environment. See Services tab for details.</small>
            <button type="button" class="install-btn" onclick="autoDetectServiceUrl('icad-transcribe', 9912, 'settings-icad-url')" style="margin-top: 5px;">Auto-Detect</button>
          </div>
          <div class="form-group">
            <label for="settings-icad-port">Web UI Port:</label>
            <input type="number" id="settings-icad-port" min="1" max="65535" value="9912" />
            <small>Port for iCAD Transcribe web interface</small>
          </div>
          <div id="icad-webui-link" style="margin-top: 10px; display: none;">
            <a href="#" id="icad-webui-link-btn" target="_blank" style="color: var(--primary-color); text-decoration: underline;">üåê Open iCAD Transcribe Web UI</a>
          </div>
          <div class="form-group" style="margin-top: 15px;">
            <label for="settings-icad-api-key">iCAD API Key:</label>
            <input type="password" id="settings-icad-api-key" placeholder="Leave empty to use default" />
            <small>API key for iCAD Transcribe (optional)</small>
          </div>
        </div>
        <div id="transcription-faster-whisper-settings" style="display: none; margin-top: 10px; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; background-color: rgba(0, 51, 0, 0.2);">
          <h4 style="margin-top: 0;">Faster-Whisper Server Configuration</h4>
          <div class="form-group">
            <label for="settings-faster-whisper-url">Faster-Whisper Server URL:</label>
            <input type="text" id="settings-faster-whisper-url" placeholder="http://localhost:8000" />
            <small>URL for Faster-Whisper server (default: http://localhost:8000)</small>
          </div>
          <div class="form-group">
            <label for="settings-faster-whisper-port">Server Port:</label>
            <input type="number" id="settings-faster-whisper-port" min="1" max="65535" value="8000" />
            <small>Port for Faster-Whisper server</small>
          </div>
        </div>
        <div class="modal-buttons">
          <button type="button" id="save-transcription-settings-btn" class="confirm-btn">Save Transcription Settings</button>
        </div>
      </div>
      
      <!-- AI Settings Tab -->
      <div id="settings-ai-tab" class="settings-tab-content">
        <h3>AI Settings</h3>
        <p class="config-description">Select one AI provider. Only one can be enabled at a time.</p>
        <div class="form-group">
          <label for="settings-ai-provider-select">AI Provider:</label>
          <select id="settings-ai-provider-select" class="styled-select" style="width: 100%;">
            <option value="openai">OpenAI - Cloud-based AI (requires API key, best accuracy)</option>
            <option value="ollama">Ollama (Local) - Local AI service (free, runs on your machine)</option>
          </select>
          <input type="hidden" id="settings-ai-provider" />
        </div>
        <div id="ai-openai-settings" style="display: none; margin-top: 10px; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; background-color: rgba(0, 51, 0, 0.2);">
          <h4 style="margin-top: 0;">OpenAI Configuration</h4>
          <div class="form-group">
            <label for="settings-openai-api-key">OpenAI API Key:</label>
            <input type="password" id="settings-openai-api-key" placeholder="sk-..." />
            <small>Your OpenAI API key (required)</small>
          </div>
          <div class="form-group">
            <label for="settings-openai-model">OpenAI Model:</label>
            <select id="settings-openai-model" class="styled-select">
              <option value="gpt-4o-mini">gpt-4o-mini (Recommended)</option>
              <option value="gpt-4o">gpt-4o (Best accuracy)</option>
              <option value="gpt-3.5-turbo">gpt-3.5-turbo (Cheapest)</option>
            </select>
            <small>Model to use for AI processing</small>
          </div>
        </div>
        <div id="ai-ollama-settings" style="display: none; margin-top: 10px; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; background-color: rgba(0, 51, 0, 0.2);">
          <h4 style="margin-top: 0;">Ollama Configuration</h4>
          <div class="form-group">
            <label for="settings-ollama-url">Ollama URL:</label>
            <input type="text" id="settings-ollama-url" placeholder="Auto-detected or enter custom URL" />
            <small>URL is auto-detected based on your environment. See Services tab for details.</small>
            <button type="button" class="install-btn" onclick="autoDetectServiceUrl('ollama', 11434, 'settings-ollama-url')" style="margin-top: 5px;">Auto-Detect</button>
          </div>
          <div class="form-group">
            <label for="settings-ollama-model">Ollama Model:</label>
            <input type="text" id="settings-ollama-model" placeholder="llama3.1:8b" />
            <small>Model name (e.g., llama3.1:8b, mistral:7b). See Models tab for hardware-specific recommendations.</small>
          </div>
          <div id="ai-ollama-recommendation" style="margin-top: 15px; padding: 10px; background-color: rgba(0, 0, 0, 0.3); border-radius: 4px; display: none;">
            <strong>Recommended for your hardware:</strong> <span id="ai-ollama-recommended-model"></span>
            <button type="button" class="install-btn" onclick="useRecommendedOllamaModel()" style="margin-left: 10px;">Use Recommended</button>
          </div>
        </div>
        <div class="modal-buttons">
          <button type="button" id="save-ai-settings-btn" class="confirm-btn">Save AI Settings</button>
        </div>
      </div>
      
      <!-- Discord Settings Tab -->
      <div id="settings-discord-tab" class="settings-tab-content">
        <h3>Discord Settings</h3>
        <div class="form-group">
          <label>
            <input type="checkbox" id="settings-discord-enabled" />
            Enable Discord Bot
          </label>
          <small>Enable Discord bot integration</small>
        </div>
        <div id="discord-settings-content" style="display: none;">
          <div class="form-group">
            <label for="settings-discord-token">Discord Bot Token:</label>
            <input type="password" id="settings-discord-token" placeholder="Your bot token" />
            <small>Discord bot token from Discord Developer Portal</small>
          </div>
          <div class="form-group">
            <label for="settings-discord-channel">Default Channel ID:</label>
            <input type="text" id="settings-discord-channel" placeholder="Channel ID" />
            <small>Default channel for posting calls</small>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="settings-discord-ai-summaries" />
              Enable AI Summaries
            </label>
            <small>Include AI-generated summaries in Discord posts</small>
          </div>
        </div>
        <div class="modal-buttons">
          <button type="button" id="save-discord-settings-btn" class="confirm-btn">Save Discord Settings</button>
        </div>
      </div>
      
      <!-- Storage Settings Tab -->
      <div id="settings-storage-tab" class="settings-tab-content">
        <h3>Storage Settings</h3>
        <p class="config-description" id="storage-status-description">Configure where audio files and data are stored.</p>
        <div class="form-group">
          <label for="settings-storage-mode">Storage Mode:</label>
          <select id="settings-storage-mode" class="styled-select">
            <option value="local">Local Files</option>
            <option value="s3">S3-Compatible Storage</option>
          </select>
          <small>Where to store audio files and data</small>
        </div>
        <div id="storage-s3-settings" style="display: none;">
          <div class="form-group">
            <label for="settings-s3-endpoint">S3 Endpoint:</label>
            <input type="text" id="settings-s3-endpoint" placeholder="https://s3.amazonaws.com" />
            <small>S3-compatible storage endpoint</small>
          </div>
          <div class="form-group">
            <label for="settings-s3-bucket">S3 Bucket:</label>
            <input type="text" id="settings-s3-bucket" placeholder="bucket-name" />
            <small>Bucket name for storage</small>
          </div>
          <div class="form-group">
            <label for="settings-s3-access-key">Access Key:</label>
            <input type="password" id="settings-s3-access-key" />
            <small>S3 access key</small>
          </div>
          <div class="form-group">
            <label for="settings-s3-secret-key">Secret Key:</label>
            <input type="password" id="settings-s3-secret-key" />
            <small>S3 secret key</small>
          </div>
          <div class="form-group">
            <label for="settings-s3-region">Region:</label>
            <input type="text" id="settings-s3-region" placeholder="us-east-1" />
            <small>S3 region</small>
          </div>
        </div>
        <div class="modal-buttons">
          <button type="button" id="save-storage-settings-btn" class="confirm-btn">Save Storage Settings</button>
        </div>
      </div>
      
      <!-- Display Settings Tab -->
      <div id="settings-display-tab" class="settings-tab-content">
        <h3>Display Settings</h3>
        <div class="form-group">
          <label for="settings-heatmap-intensity">Heatmap Intensity:</label>
          <input type="range" id="settings-heatmap-intensity" min="1" max="10" value="5" />
          <span id="settings-heatmap-intensity-display">5</span>
          <small>Intensity of the heatmap overlay</small>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="settings-heatmap-enabled" />
            Enable Heatmap by Default
          </label>
          <small>Show heatmap when map loads</small>
        </div>
        <div class="form-group">
          <label for="settings-max-markers">Maximum Visible Markers:</label>
          <input type="number" id="settings-max-markers" min="10" max="10000" value="1000" />
          <small>Maximum number of markers to display at once</small>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="settings-cluster-markers" checked />
            Cluster Markers
          </label>
          <small>Group nearby markers into clusters</small>
        </div>
        <div class="modal-buttons">
          <button type="button" id="save-display-settings-btn" class="confirm-btn">Save Display Settings</button>
        </div>
      </div>
      
      <!-- API Keys Tab -->
      <div id="settings-api-keys-tab" class="settings-tab-content">
        <h3>API Keys Management</h3>
        <p class="config-description">Manage API keys for various services. Keys are stored securely and never displayed in full.</p>
        <div class="form-group">
          <label for="settings-google-maps-key">Google Maps API Key:</label>
          <input type="password" id="settings-google-maps-key" placeholder="Enter key to update" />
          <small>For Google Maps geocoding and Places autocomplete</small>
        </div>
        <div class="form-group">
          <label for="settings-locationiq-key">LocationIQ API Key:</label>
          <input type="password" id="settings-locationiq-key" placeholder="Enter key to update" />
          <small>For LocationIQ geocoding service</small>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="settings-show-api-keys" />
            Show API Keys (for verification)
          </label>
          <small>Display masked API keys to verify they're set</small>
        </div>
        <div id="api-keys-display" style="display: none; margin-top: 15px; padding: 10px; background-color: rgba(0, 0, 0, 0.3); border-radius: 4px;">
          <div id="api-keys-list"></div>
        </div>
        <div class="modal-buttons">
          <button type="button" id="save-api-keys-btn" class="confirm-btn">Save API Keys</button>
        </div>
      </div>
      
      <!-- Logs Tab -->
      <div id="settings-logs-tab" class="settings-tab-content">
        <h3>Application Logs</h3>
        <p class="config-description">View and monitor application logs in real-time.</p>
        
        <div class="form-group" style="margin-bottom: 10px;">
          <label for="logs-filter">Filter Logs:</label>
          <select id="logs-filter" class="styled-select" style="width: 100%;">
            <option value="all">All Logs</option>
            <option value="webserver">Webserver</option>
            <option value="bot">Discord Bot</option>
            <option value="transcription">Transcription</option>
            <option value="geocoding">Geocoding</option>
            <option value="errors">Errors Only</option>
          </select>
        </div>
        
        <div class="form-group" style="margin-bottom: 10px;">
          <label>
            <input type="checkbox" id="logs-auto-refresh" checked />
            Auto-refresh (every 5 seconds)
          </label>
        </div>
        
        <div id="logs-container" style="background-color: rgba(0, 0, 0, 0.5); border: 1px solid var(--border-color); border-radius: 4px; padding: 10px; max-height: 500px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.4;">
          <div id="logs-content" style="color: var(--text-color); white-space: pre-wrap; word-wrap: break-word;">
            Loading logs...
          </div>
        </div>
        
        <div class="modal-buttons" style="margin-top: 10px;">
          <button type="button" class="install-btn" onclick="refreshLogs()">Refresh Logs</button>
          <button type="button" class="install-btn" onclick="clearLogsDisplay()">Clear Display</button>
          <button type="button" class="install-btn" onclick="downloadLogs()">Download Logs</button>
        </div>
      </div>
      
      <div class="modal-buttons" style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 15px;">
        <button type="button" class="cancel-btn" onclick="document.getElementById('settings-modal').style.display='none'">Close</button>
      </div>
    </div>
  </div>
  <!-- END Settings Modal -->
  
  <!-- Service Configuration Modal -->
  <div id="service-config-modal" class="modal">
    <div class="modal-content">
      <h2>Service Configuration</h2>
      <p class="config-description">Configure remote service URLs for Ollama and iCAD Transcribe. Leave empty to use local Docker containers.</p>
      
      <div class="form-group">
        <label for="ollama-url">Ollama URL:</label>
        <input type="text" id="ollama-url" placeholder="http://localhost:11434 or http://remote-server:11434" />
        <small>Leave empty to use local Docker container</small>
      </div>
      
      <div class="form-group">
        <label for="icad-url">iCAD Transcribe URL:</label>
        <input type="text" id="icad-url" placeholder="http://localhost:9912 or http://remote-server:9912" />
        <small>Leave empty to use local Docker container</small>
      </div>
      
      <div class="modal-buttons">
        <button type="button" id="save-service-config-btn" class="confirm-btn">Save Configuration</button>
        <button type="button" class="cancel-btn" onclick="document.getElementById('service-config-modal').style.display='none'">Cancel</button>
      </div>
    </div>
  </div>
  <!-- END Service Configuration Modal -->

  <!-- Setup Wizard Modal -->
  <div id="setup-wizard-modal" class="modal">
    <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px;">
        <h2 style="margin: 0;">Scanner Map Setup Wizard</h2>
        <button type="button" class="cancel-btn" onclick="closeSetupWizard()" style="margin: 0;">‚úï</button>
      </div>
      <!-- Progress Indicator -->
      <div id="wizard-progress" style="margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
          <span id="wizard-step-indicator" style="font-size: 0.9em; color: var(--text-color); opacity: 0.8;">Step 1 of 6</span>
          <span id="wizard-progress-percent" style="font-size: 0.9em; color: var(--text-color); opacity: 0.8;">0%</span>
        </div>
        <div style="width: 100%; height: 8px; background-color: rgba(0, 255, 0, 0.1); border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden;">
          <div id="wizard-progress-bar" style="height: 100%; background-color: var(--primary-color); width: 0%; transition: width 0.3s;"></div>
        </div>
      </div>
      
      <!-- Step 1: Welcome & System Detection -->
      <div id="wizard-step-1" class="wizard-step active">
        <h3>Welcome to Scanner Map</h3>
        <p class="config-description">This wizard will guide you through setting up Scanner Map for first-time use. We'll automatically detect your system capabilities and configure everything for optimal performance.</p>
        
        <div style="margin: 20px 0; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px; background-color: rgba(0, 51, 0, 0.2);">
          <h4 style="margin-top: 0;">What we'll configure:</h4>
          <ul style="margin: 10px 0; padding-left: 20px;">
            <li>System hardware and capabilities</li>
            <li>Installation type (Local, Docker, or Hybrid)</li>
            <li>Location for accurate geocoding</li>
            <li>SDR devices and radio configuration</li>
            <li>AI and transcription services</li>
            <li>Complete working configuration</li>
          </ul>
        </div>
        
        <div id="wizard-detection-status" style="margin: 20px 0; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4>Detecting System...</h4>
          <div id="wizard-detection-details" style="margin-top: 10px;">
            <div style="display: flex; align-items: center; margin: 5px 0;">
              <span style="width: 20px;">‚è≥</span>
              <span>Operating system and architecture...</span>
            </div>
            <div style="display: flex; align-items: center; margin: 5px 0;">
              <span style="width: 20px;">‚è≥</span>
              <span>CPU and available resources...</span>
            </div>
            <div style="display: flex; align-items: center; margin: 5px 0;">
              <span style="width: 20px;">‚è≥</span>
              <span>GPU and hardware acceleration...</span>
            </div>
            <div style="display: flex; align-items: center; margin: 5px 0;">
              <span style="width: 20px;">‚è≥</span>
              <span>SDR devices...</span>
            </div>
            <div style="display: flex; align-items: center; margin: 5px 0;">
              <span style="width: 20px;">‚è≥</span>
              <span>Docker availability...</span>
            </div>
            <div style="display: flex; align-items: center; margin: 5px 0;">
              <span style="width: 20px;">‚è≥</span>
              <span>Available services...</span>
            </div>
          </div>
        </div>
        
        <div id="wizard-detection-results" style="display: none; margin: 20px 0; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px; background-color: rgba(0, 51, 0, 0.2);">
          <h4>Detection Results</h4>
          <div id="wizard-detection-summary" style="margin-top: 10px; font-family: 'Courier New', monospace; font-size: 0.9em;"></div>
        </div>
      </div>
      
      <!-- Step 2: Installation Type -->
      <div id="wizard-step-2" class="wizard-step">
        <h3>Choose Installation Type</h3>
        <p class="config-description">Select how you want to run Scanner Map. The wizard will adapt based on your system capabilities.</p>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
          <label class="wizard-option-card" data-install-type="local">
            <input type="radio" name="installation-type" value="local" />
            <div style="padding: 15px;">
              <h4 style="margin-top: 0;">üñ•Ô∏è Local Installation</h4>
              <p style="font-size: 0.9em; opacity: 0.8; margin: 10px 0;">Run everything directly on your computer. Best for single-machine setups.</p>
              <ul style="font-size: 0.85em; margin: 10px 0; padding-left: 20px; opacity: 0.7;">
                <li>No Docker required</li>
                <li>Direct hardware access</li>
                <li>Simpler setup</li>
              </ul>
            </div>
          </label>
          
          <label class="wizard-option-card" data-install-type="docker">
            <input type="radio" name="installation-type" value="docker" />
            <div style="padding: 15px;">
              <h4 style="margin-top: 0;">üê≥ Docker Installation</h4>
              <p style="font-size: 0.9em; opacity: 0.8; margin: 10px 0;">Run in containers. Best for isolation and easy updates.</p>
              <ul style="font-size: 0.85em; margin: 10px 0; padding-left: 20px; opacity: 0.7;">
                <li>Isolated services</li>
                <li>Easy updates</li>
                <li>GPU support</li>
              </ul>
            </div>
          </label>
          
          <label class="wizard-option-card" data-install-type="hybrid">
            <input type="radio" name="installation-type" value="hybrid" />
            <div style="padding: 15px;">
              <h4 style="margin-top: 0;">üîÄ Hybrid Installation</h4>
              <p style="font-size: 0.9em; opacity: 0.8; margin: 10px 0;">Mix of local and remote services. Best for distributed setups.</p>
              <ul style="font-size: 0.85em; margin: 10px 0; padding-left: 20px; opacity: 0.7;">
                <li>Local UI, remote services</li>
                <li>Flexible configuration</li>
                <li>Network-based SDR</li>
              </ul>
            </div>
          </label>
        </div>
        
        <div id="wizard-install-warnings" style="margin-top: 20px; display: none;"></div>
      </div>
      
      <!-- Step 3: Location Configuration -->
      <div id="wizard-step-3" class="wizard-step">
        <h3>Configure Your Location</h3>
        <p class="config-description">Set your location for accurate geocoding of radio calls. This helps the system understand addresses in your area.</p>
        
        <div class="form-group">
          <button type="button" id="wizard-detect-location-btn" class="confirm-btn">üìç Detect My Location</button>
          <span id="wizard-location-detect-status" style="margin-left: 10px;"></span>
        </div>
        
        <div id="wizard-location-map-container" style="height: 300px; margin: 15px 0; display: none; border: 1px solid var(--border-color); border-radius: 4px;"></div>
        
        <div class="form-group">
          <label for="wizard-geocoding-city">City:</label>
          <input type="text" id="wizard-geocoding-city" placeholder="e.g., Baltimore" />
          <small>Your city name</small>
        </div>
        
        <div class="form-group">
          <label for="wizard-geocoding-state">State/Province:</label>
          <input type="text" id="wizard-geocoding-state" placeholder="e.g., MD" />
          <small>State or province code</small>
        </div>
        
        <div class="form-group">
          <label for="wizard-geocoding-country">Country:</label>
          <input type="text" id="wizard-geocoding-country" placeholder="e.g., us" value="us" />
          <small>Country code (ISO 3166-1 alpha-2)</small>
        </div>
        
        <div class="form-group">
          <label for="wizard-geocoding-counties">Target Counties (optional):</label>
          <input type="text" id="wizard-geocoding-counties" placeholder="e.g., Baltimore, Baltimore City, Anne Arundel" />
          <small>Comma-separated list of counties to prioritize in geocoding</small>
        </div>
        
        <div id="wizard-location-suggestions" style="margin: 15px 0;"></div>
      </div>
      
      <!-- Step 4: SDR & Radio Configuration -->
      <div id="wizard-step-4" class="wizard-step">
        <h3>SDR Devices & Radio Configuration</h3>
        <p class="config-description">Configure your Software Defined Radio devices and import channel information.</p>
        
        <!-- SDR Detection -->
        <div style="margin: 20px 0; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4 style="margin-top: 0;">Detected SDR Devices</h4>
          <div id="wizard-sdr-devices" style="margin-top: 10px;">
            <div style="padding: 10px; background-color: rgba(0, 0, 0, 0.3); border-radius: 4px;">
              <div style="display: flex; align-items: center;">
                <span style="width: 20px;">‚è≥</span>
                <span>Detecting SDR devices...</span>
              </div>
            </div>
          </div>
          <button type="button" id="wizard-rescan-sdr-btn" class="install-btn" style="margin-top: 10px; display: none;">Rescan Devices</button>
        </div>
        
        <!-- Radio Software Selection -->
        <div style="margin: 20px 0; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4 style="margin-top: 0;">Radio Software</h4>
          <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 10px;">Select the software you'll use to capture radio signals:</p>
          <select id="wizard-radio-software" class="styled-select" style="width: 100%;">
            <option value="">Auto-detect</option>
            <option value="trunk-recorder">TrunkRecorder</option>
            <option value="sdrtrunk">SDRTrunk</option>
            <option value="rdio-scanner">Rdio Scanner</option>
            <option value="op25">OP25</option>
          </select>
          <small>We'll auto-configure the selected software with your channels</small>
        </div>
        
        <!-- Channel Import -->
        <div style="margin: 20px 0; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4 style="margin-top: 0;">Import Channels</h4>
          <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 10px;">Import talkgroups and frequencies from RadioReference or CSV files:</p>
          
          <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <button type="button" id="wizard-import-radioreference-btn" class="confirm-btn">Import RadioReference CSV</button>
            <button type="button" id="wizard-import-custom-csv-btn" class="confirm-btn">Import Custom CSV</button>
          </div>
          
          <div id="wizard-import-section" style="display: none; margin-top: 15px; padding: 15px; border: 2px dashed var(--border-color); border-radius: 4px;">
            <input type="file" id="wizard-channel-file" accept=".csv" style="display: none;" />
            <div id="wizard-channel-drop-zone" style="text-align: center; padding: 20px; cursor: pointer;">
              <p>üìÅ Drag and drop CSV file here, or click to select</p>
            </div>
            <div id="wizard-import-preview" style="display: none; margin-top: 15px; max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); padding: 10px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 0.85em;"></div>
            <div id="wizard-import-status" style="margin-top: 10px;"></div>
          </div>
          
          <div id="wizard-imported-channels" style="display: none; margin-top: 15px; padding: 10px; background-color: rgba(0, 51, 0, 0.2); border-radius: 4px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span>Imported: <strong id="wizard-imported-count">0</strong> talkgroups, <strong id="wizard-imported-freq-count">0</strong> frequencies</span>
              <button type="button" id="wizard-clear-import-btn" class="cancel-btn" style="padding: 5px 10px; font-size: 0.9em;">Clear</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Step 5: Services Configuration -->
      <div id="wizard-step-5" class="wizard-step">
        <h3>AI & Transcription Services</h3>
        <p class="config-description">Configure optional AI and transcription services. These enhance Scanner Map with intelligent features.</p>
        
        <!-- Transcription Service -->
        <div style="margin: 20px 0; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4 style="margin-top: 0;">Transcription Service</h4>
          <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 10px;">Choose how audio will be transcribed:</p>
          <select id="wizard-transcription-mode" class="styled-select" style="width: 100%;">
            <option value="local">Local (Whisper) - Built-in, no external service</option>
            <option value="icad">iCAD Transcribe - Advanced with web UI</option>
            <option value="openai">OpenAI Whisper API - Cloud-based</option>
            <option value="faster-whisper">Faster-Whisper Server - Remote server</option>
          </select>
          
          <div id="wizard-transcription-icad-settings" style="display: none; margin-top: 15px; padding: 10px; background-color: rgba(0, 0, 0, 0.3); border-radius: 4px;">
            <div class="form-group">
              <label for="wizard-icad-url">iCAD URL:</label>
              <input type="text" id="wizard-icad-url" placeholder="Auto-detected" />
              <button type="button" class="install-btn" onclick="wizardAutoDetectService('icad-transcribe', 9912, 'wizard-icad-url')" style="margin-top: 5px;">Auto-Detect</button>
            </div>
          </div>
          
          <div id="wizard-transcription-openai-settings" style="display: none; margin-top: 15px; padding: 10px; background-color: rgba(0, 0, 0, 0.3); border-radius: 4px;">
            <div class="form-group">
              <label for="wizard-openai-api-key">OpenAI API Key:</label>
              <input type="password" id="wizard-openai-api-key" placeholder="sk-..." />
              <small>Required for OpenAI Whisper API</small>
            </div>
          </div>
        </div>
        
        <!-- AI Service -->
        <div style="margin: 20px 0; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4 style="margin-top: 0;">AI Service</h4>
          <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 10px;">Choose AI provider for intelligent features:</p>
          <select id="wizard-ai-provider" class="styled-select" style="width: 100%;">
            <option value="ollama">Ollama (Local) - Free, runs on your machine</option>
            <option value="openai">OpenAI - Cloud-based, best accuracy</option>
          </select>
          
          <div id="wizard-ai-ollama-settings" style="margin-top: 15px; padding: 10px; background-color: rgba(0, 0, 0, 0.3); border-radius: 4px;">
            <div class="form-group">
              <label for="wizard-ollama-url">Ollama URL:</label>
              <input type="text" id="wizard-ollama-url" placeholder="Auto-detected" />
              <button type="button" class="install-btn" onclick="wizardAutoDetectService('ollama', 11434, 'wizard-ollama-url')" style="margin-top: 5px;">Auto-Detect</button>
            </div>
            <div class="form-group">
              <label for="wizard-ollama-model">Model:</label>
              <input type="text" id="wizard-ollama-model" placeholder="llama3.1:8b" />
              <small>Recommended model will be suggested based on your hardware</small>
            </div>
          </div>
          
          <div id="wizard-ai-openai-settings" style="display: none; margin-top: 15px; padding: 10px; background-color: rgba(0, 0, 0, 0.3); border-radius: 4px;">
            <div class="form-group">
              <label for="wizard-openai-ai-api-key">OpenAI API Key:</label>
              <input type="password" id="wizard-openai-ai-api-key" placeholder="sk-..." />
              <small>Required for OpenAI AI features</small>
            </div>
            <div class="form-group">
              <label for="wizard-openai-model">Model:</label>
              <select id="wizard-openai-model" class="styled-select" style="width: 100%;">
                <option value="gpt-4o-mini">gpt-4o-mini (Recommended)</option>
                <option value="gpt-4o">gpt-4o (Best accuracy)</option>
                <option value="gpt-3.5-turbo">gpt-3.5-turbo (Cheapest)</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Step 6: Review & Apply -->
      <div id="wizard-step-6" class="wizard-step">
        <h3>Review Configuration</h3>
        <p class="config-description">Review your configuration before applying. Everything will be set up automatically.</p>
        
        <div id="wizard-review-summary" style="margin: 20px 0; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px; background-color: rgba(0, 51, 0, 0.2);">
          <h4 style="margin-top: 0;">Configuration Summary</h4>
          <div id="wizard-review-content" style="margin-top: 10px; font-family: 'Courier New', monospace; font-size: 0.9em; line-height: 1.6;"></div>
        </div>
        
        <div id="wizard-validation-errors" style="display: none; margin: 20px 0; padding: 15px; border: 1px solid #ff0000; border-radius: 4px; background-color: rgba(255, 0, 0, 0.1);">
          <h4 style="margin-top: 0; color: #ff0000;">‚ö†Ô∏è Configuration Issues</h4>
          <div id="wizard-validation-errors-content" style="margin-top: 10px; color: #ff0000;"></div>
        </div>
        
        <div id="wizard-apply-progress" style="display: none; margin: 20px 0; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4>Applying Configuration...</h4>
          <div id="wizard-apply-status" style="margin-top: 10px;"></div>
          <div style="width: 100%; height: 8px; background-color: rgba(0, 255, 0, 0.1); border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden; margin-top: 10px;">
            <div id="wizard-apply-progress-bar" style="height: 100%; background-color: var(--primary-color); width: 0%; transition: width 0.3s;"></div>
          </div>
        </div>
        
        <div id="wizard-apply-success" style="display: none; margin: 20px 0; padding: 15px; border: 1px solid var(--primary-color); border-radius: 4px; background-color: rgba(0, 255, 0, 0.1);">
          <h4 style="margin-top: 0; color: var(--primary-color);">‚úÖ Configuration Applied Successfully!</h4>
          <p>Scanner Map is now configured and ready to use. You can start using the application immediately.</p>
        </div>
      </div>
      
      <!-- OLD QUICK START CONTENT TO BE REMOVED -->
      <!-- Location Tab -->
      <div id="quick-start-location-tab" class="quick-start-tab-content" style="display: none;">
        <h3>Location Configuration</h3>
        <p class="config-description">Configure your location for accurate geocoding of radio calls.</p>
        
        <div class="form-group">
          <button type="button" id="detect-location-btn" class="confirm-btn">Detect My Location</button>
          <span id="location-detect-status"></span>
        </div>
        
        <div id="location-map-container" style="height: 300px; margin: 15px 0; display: none;"></div>
        
        <div class="form-group">
          <label for="geocoding-city">City:</label>
          <input type="text" id="geocoding-city" placeholder="e.g., Baltimore" />
        </div>
        
        <div class="form-group">
          <label for="geocoding-state">State/Province:</label>
          <input type="text" id="geocoding-state" placeholder="e.g., MD" />
        </div>
        
        <div class="form-group">
          <label for="geocoding-country">Country:</label>
          <input type="text" id="geocoding-country" placeholder="e.g., us" />
        </div>
        
        <div class="form-group">
          <label for="geocoding-counties">Target Counties (comma-separated):</label>
          <input type="text" id="geocoding-counties" placeholder="e.g., Baltimore, Baltimore City, Anne Arundel" />
        </div>
        
        <div id="location-suggestions" style="margin: 15px 0;"></div>
        
        <div class="modal-buttons">
          <button type="button" id="save-location-btn" class="confirm-btn">Save Location</button>
        </div>
      </div>
      
      <!-- System Status Tab -->
      <div id="quick-start-system-tab" class="quick-start-tab-content">
        <h3>System Status & Dependencies</h3>
        <p class="config-description">Check system requirements, dependencies, and optional services. Install missing components directly from here.</p>
        
        <!-- Installation Mode Indicator -->
        <div id="installation-mode-indicator" style="margin-bottom: 20px; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; background-color: rgba(0, 51, 0, 0.3);">
          <strong>Installation Mode:</strong> <span id="installation-mode-text">Checking...</span>
          <div style="font-size: 0.9em; margin-top: 5px; opacity: 0.8;" id="installation-mode-description"></div>
        </div>
        
        <!-- Core Dependencies Section -->
        <div style="margin-bottom: 25px;">
          <h4 style="margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px;">Core Dependencies</h4>
          <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 15px;">Required for Scanner Map to run</p>
          <div id="system-status-list">
            <div class="system-status-item">
              <span class="system-status-name">Docker</span>
              <span class="system-status-icon" id="docker-status">‚è≥ Checking...</span>
              <button type="button" id="install-docker-btn" class="install-btn" style="display: none;" disabled>Install</button>
            </div>
            <div class="system-status-item">
              <span class="system-status-name">Node.js</span>
              <span class="system-status-icon" id="nodejs-status">‚è≥ Checking...</span>
              <button type="button" id="install-nodejs-btn" class="install-btn" style="display: none;" disabled>Install</button>
            </div>
            <div class="system-status-item">
              <span class="system-status-name">Python</span>
              <span class="system-status-icon" id="python-status">‚è≥ Checking...</span>
              <button type="button" id="install-python-btn" class="install-btn" style="display: none;" disabled>Install</button>
            </div>
          </div>
        </div>
        
        <!-- Optional Services Section -->
        <div style="margin-bottom: 25px;">
          <h4 style="margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px;">Optional Services</h4>
          <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 15px;">AI and transcription services (install as Docker containers or locally)</p>
          <div id="services-status-list">
            <div class="system-status-item">
              <span class="system-status-name">Ollama (AI)</span>
              <span class="system-status-icon" id="ollama-status">‚è≥ Checking...</span>
              <div style="display: flex; gap: 5px;">
                <button type="button" id="install-ollama-local-btn" class="install-btn" style="display: none;" disabled>Install Local</button>
                <button type="button" id="install-ollama-docker-btn" class="install-btn" style="display: none;" disabled>Install Docker</button>
              </div>
            </div>
            <div class="system-status-item">
              <span class="system-status-name">faster-whisper</span>
              <span class="system-status-icon" id="faster-whisper-status">‚è≥ Checking...</span>
              <button type="button" id="install-faster-whisper-btn" class="install-btn" style="display: none;" disabled>Install</button>
            </div>
            <div class="system-status-item">
              <span class="system-status-name">iCAD Transcribe</span>
              <span class="system-status-icon" id="icad-status">‚è≥ Checking...</span>
              <div style="display: flex; gap: 5px;">
                <button type="button" id="install-icad-local-btn" class="install-btn" style="display: none;" disabled>Install Local</button>
                <button type="button" id="install-icad-docker-btn" class="install-btn" style="display: none;" disabled>Install Docker</button>
              </div>
            </div>
          </div>
        </div>
        
        <div id="system-info" style="margin-top: 20px;">
          <h4>System Information</h4>
          <div id="system-info-content">Loading...</div>
        </div>
        
        <div id="gpu-config" style="margin-top: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4>GPU Configuration (Docker only)</h4>
          <div id="gpu-status-display">
            <div>Status: <span id="gpu-status-text">Loading...</span></div>
            <div id="gpu-name" style="margin-top: 10px;"></div>
            <div style="margin-top: 10px;">
              <label>
                <input type="checkbox" id="gpu-enabled-checkbox" />
                Enable GPU acceleration
              </label>
            </div>
            <div id="nvidia-toolkit-section" style="margin-top: 10px; display: none;">
              <button type="button" id="install-nvidia-toolkit-btn" class="install-btn">Install NVIDIA Container Toolkit</button>
            </div>
          </div>
        </div>
        
        <div id="autostart-config" style="margin-top: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4>Auto-Start Configuration</h4>
          <div id="autostart-status-display">
            <div>Status: <span id="autostart-status-text">Loading...</span></div>
            <div style="margin-top: 10px;">
              <label>
                <input type="checkbox" id="autostart-enabled-checkbox" />
                Start Scanner Map automatically on system boot
              </label>
            </div>
          </div>
        </div>
        
        <!-- Model Recommendations Section -->
        <div id="model-recommendations" style="margin-top: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4>AI Model Recommendations</h4>
          <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 15px;">Recommended models for your hardware (optimized for public safety)</p>
          <div id="model-recommendations-content">Loading recommendations...</div>
        </div>
        
        <!-- Service Status Section -->
        <div id="service-status" style="margin-top: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4>Service Status</h4>
          <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 15px;">Current status of installed services</p>
          <div id="service-status-content">Loading status...</div>
        </div>
      </div>
      
      <!-- Models Tab -->
      <div id="quick-start-models-tab" class="quick-start-tab-content">
        <h3>AI Model Management</h3>
        <p class="config-description">Get hardware-specific model recommendations and manage installed models. Optimized for public safety transcription, geolocation, and summarization.</p>
        
        <!-- Hardware Detection -->
        <div style="margin-bottom: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px; background-color: rgba(0, 51, 0, 0.2);">
          <h4 style="margin-top: 0;">Your Hardware</h4>
          <div id="quickstart-hardware-info">Detecting hardware...</div>
        </div>
        
        <!-- Model Recommendations (same as System Status tab but more detailed) -->
        <div id="quickstart-model-recommendations" style="margin-bottom: 25px;">
          <h4>Recommended Models</h4>
          <div id="quickstart-model-recommendations-content">Loading recommendations...</div>
        </div>
        
        <!-- Installed Models -->
        <div style="margin-bottom: 25px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4 style="margin-top: 0;">Installed Models</h4>
          <div id="quickstart-installed-models-content">Loading installed models...</div>
          <button type="button" class="install-btn" onclick="loadQuickStartInstalledModels()" style="margin-top: 10px;">Refresh Model List</button>
        </div>
        
        <!-- Quick Pull Section -->
        <div style="margin-bottom: 25px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h4 style="margin-top: 0;">Quick Actions</h4>
          <div class="form-group">
            <label for="quickstart-pull-model-name">Pull Model:</label>
            <input type="text" id="quickstart-pull-model-name" placeholder="Enter model name (e.g., llama3.1:8b)" />
            <small>Pull a model from Ollama. This may take several minutes.</small>
          </div>
          <button type="button" class="confirm-btn" onclick="pullModelFromQuickStart()">Pull Model</button>
          <div id="quickstart-pull-model-status" style="margin-top: 10px;"></div>
        </div>
      </div>
      
      <!-- Updates Tab -->
      <div id="quick-start-updates-tab" class="quick-start-tab-content">
        <h3>Update Scanner Map</h3>
        <p class="config-description">Check for updates and configure auto-update.</p>
        
        <div id="update-status">
          <div class="update-info-item">
            <span>Current Version:</span>
            <span id="current-version">Loading...</span>
          </div>
          <div class="update-info-item">
            <span>Latest Version:</span>
            <span id="latest-version">Loading...</span>
          </div>
          <div id="update-available-badge" style="display: none; margin: 10px 0; padding: 10px; background-color: #00ff00; color: #000; border-radius: 4px;">
            Update Available!
          </div>
        </div>
        
        <div class="modal-buttons" style="margin-top: 20px;">
          <button type="button" id="check-updates-btn" class="confirm-btn">Check for Updates</button>
          <button type="button" id="install-update-btn" class="confirm-btn" style="display: none;">Install Update</button>
        </div>
        
        <div class="form-group" style="margin-top: 20px;">
          <label>
            <input type="checkbox" id="auto-update-checkbox" />
            Enable auto-update (checks on startup)
          </label>
        </div>
      </div>
      
      <!-- Radio Config Tab -->
      <div id="quick-start-radio-tab" class="quick-start-tab-content">
        <h3>Radio Configuration</h3>
        <p class="config-description">Manage talkgroups and frequencies.</p>
        
        <div class="quick-start-radio-subtabs">
          <button class="quick-start-subtab active" data-subtab="talkgroups">Talkgroups</button>
          <button class="quick-start-subtab" data-subtab="frequencies">Frequencies</button>
          <button class="quick-start-subtab" data-subtab="software-config">Auto-Config</button>
        </div>
        
        <!-- Talkgroups Sub-tab -->
        <div id="radio-talkgroups-subtab" class="quick-start-subtab-content active">
          <div class="form-group" style="display: flex; gap: 10px; margin-bottom: 15px;">
            <button type="button" id="add-talkgroup-btn" class="confirm-btn">Add Talkgroup</button>
            <button type="button" id="import-talkgroups-csv-btn" class="confirm-btn">Import CSV</button>
          </div>
          
          <!-- CSV Import Section (hidden by default) -->
          <div id="talkgroups-csv-import-section" style="display: none; margin-bottom: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
            <h4>Import Talkgroups from CSV</h4>
            <div class="form-group">
              <label for="talkgroups-csv-file">Select CSV file:</label>
              <input type="file" id="talkgroups-csv-file" accept=".csv" style="margin-top: 5px;" />
              <div style="margin-top: 10px; padding: 10px; border: 2px dashed var(--border-color); border-radius: 4px; text-align: center; cursor: pointer;" id="talkgroups-csv-drop-zone">
                <p>Drag and drop CSV file here, or click to select</p>
              </div>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="talkgroups-csv-merge" />
                Merge/Update existing entries (if unchecked, will only add new entries)
              </label>
            </div>
            <div id="talkgroups-csv-preview" style="margin-top: 15px; display: none;">
              <h5>Preview (first 10 rows):</h5>
              <div id="talkgroups-csv-preview-content" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); padding: 10px;"></div>
              <div id="talkgroups-csv-preview-errors" style="margin-top: 10px; color: #ff0000;"></div>
              <div style="margin-top: 10px;">
                <button type="button" id="talkgroups-csv-import-btn" class="confirm-btn">Import CSV</button>
                <button type="button" id="talkgroups-csv-cancel-btn" class="cancel-btn">Cancel</button>
              </div>
            </div>
            <div id="talkgroups-csv-progress" style="display: none; margin-top: 15px;">
              <div>Importing...</div>
              <div id="talkgroups-csv-progress-bar" style="width: 100%; height: 20px; background-color: rgba(0, 255, 0, 0.2); border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden;">
                <div id="talkgroups-csv-progress-fill" style="height: 100%; background-color: var(--primary-color); width: 0%; transition: width 0.3s;"></div>
              </div>
            </div>
            <div id="talkgroups-csv-results" style="display: none; margin-top: 15px; padding: 10px; border-radius: 4px;"></div>
          </div>
          <div id="talkgroups-list-container">
            <table id="talkgroups-table" style="width: 100%; margin-top: 15px;">
              <thead>
                <tr>
                  <th>DEC</th>
                  <th>HEX</th>
                  <th>Alpha Tag</th>
                  <th>Mode</th>
                  <th>Description</th>
                  <th>Tag</th>
                  <th>County</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="talkgroups-table-body">
                <tr><td colspan="8">Loading...</td></tr>
              </tbody>
            </table>
          </div>
          
          <!-- Talkgroup Edit Form (hidden by default) -->
          <div id="talkgroup-edit-form" style="display: none; margin-top: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
            <h4 id="talkgroup-form-title">Add Talkgroup</h4>
            <div class="form-group">
              <label for="talkgroup-dec">DEC (required):</label>
              <input type="number" id="talkgroup-dec" required />
            </div>
            <div class="form-group">
              <label for="talkgroup-hex">HEX:</label>
              <input type="text" id="talkgroup-hex" />
            </div>
            <div class="form-group">
              <label for="talkgroup-alpha-tag">Alpha Tag:</label>
              <input type="text" id="talkgroup-alpha-tag" />
            </div>
            <div class="form-group">
              <label for="talkgroup-mode">Mode:</label>
              <input type="text" id="talkgroup-mode" />
            </div>
            <div class="form-group">
              <label for="talkgroup-description">Description:</label>
              <input type="text" id="talkgroup-description" />
            </div>
            <div class="form-group">
              <label for="talkgroup-tag">Tag:</label>
              <input type="text" id="talkgroup-tag" />
            </div>
            <div class="form-group">
              <label for="talkgroup-county">County:</label>
              <input type="text" id="talkgroup-county" />
            </div>
            <div class="modal-buttons">
              <button type="button" id="save-talkgroup-btn" class="confirm-btn">Save</button>
              <button type="button" id="cancel-talkgroup-btn" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>
        
        <!-- Frequencies Sub-tab -->
        <div id="radio-frequencies-subtab" class="quick-start-subtab-content">
          <div class="form-group" style="display: flex; gap: 10px; margin-bottom: 15px;">
            <button type="button" id="add-frequency-btn" class="confirm-btn">Add Frequency</button>
            <button type="button" id="import-frequencies-csv-btn" class="confirm-btn">Import CSV</button>
          </div>
          
          <!-- CSV Import Section (hidden by default) -->
          <div id="frequencies-csv-import-section" style="display: none; margin-bottom: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
            <h4>Import Frequencies from CSV</h4>
            <div class="form-group">
              <label for="frequencies-csv-file">Select CSV file:</label>
              <input type="file" id="frequencies-csv-file" accept=".csv" style="margin-top: 5px;" />
              <div style="margin-top: 10px; padding: 10px; border: 2px dashed var(--border-color); border-radius: 4px; text-align: center; cursor: pointer;" id="frequencies-csv-drop-zone">
                <p>Drag and drop CSV file here, or click to select</p>
              </div>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="frequencies-csv-merge" />
                Merge/Update existing entries (if unchecked, will only add new entries)
              </label>
            </div>
            <div id="frequencies-csv-preview" style="margin-top: 15px; display: none;">
              <h5>Preview (first 10 rows):</h5>
              <div id="frequencies-csv-preview-content" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); padding: 10px;"></div>
              <div id="frequencies-csv-preview-errors" style="margin-top: 10px; color: #ff0000;"></div>
              <div style="margin-top: 10px;">
                <button type="button" id="frequencies-csv-import-btn" class="confirm-btn">Import CSV</button>
                <button type="button" id="frequencies-csv-cancel-btn" class="cancel-btn">Cancel</button>
              </div>
            </div>
            <div id="frequencies-csv-progress" style="display: none; margin-top: 15px;">
              <div>Importing...</div>
              <div id="frequencies-csv-progress-bar" style="width: 100%; height: 20px; background-color: rgba(0, 255, 0, 0.2); border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden;">
                <div id="frequencies-csv-progress-fill" style="height: 100%; background-color: var(--primary-color); width: 0%; transition: width 0.3s;"></div>
              </div>
            </div>
            <div id="frequencies-csv-results" style="display: none; margin-top: 15px; padding: 10px; border-radius: 4px;"></div>
          </div>
          <div id="frequencies-list-container">
            <table id="frequencies-table" style="width: 100%; margin-top: 15px;">
              <thead>
                <tr>
                  <th>Site ID</th>
                  <th>Frequency (MHz)</th>
                  <th>Description</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="frequencies-table-body">
                <tr><td colspan="4">Loading...</td></tr>
              </tbody>
            </table>
          </div>
          
          <!-- Frequency Edit Form (hidden by default) -->
          <div id="frequency-edit-form" style="display: none; margin-top: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
            <h4 id="frequency-form-title">Add Frequency</h4>
            <div class="form-group">
              <label for="frequency-site-id">Site ID:</label>
              <input type="number" id="frequency-site-id" />
            </div>
            <div class="form-group">
              <label for="frequency-value">Frequency (MHz) (required):</label>
              <input type="number" id="frequency-value" step="0.0001" required />
            </div>
            <div class="form-group">
              <label for="frequency-description">Description:</label>
              <input type="text" id="frequency-description" />
            </div>
            <div class="modal-buttons">
              <button type="button" id="save-frequency-btn" class="confirm-btn">Save</button>
              <button type="button" id="cancel-frequency-btn" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>
        
        <!-- Radio Software Auto-Config Sub-tab -->
        <div id="radio-software-config-subtab" class="quick-start-subtab-content">
          <h4>Radio Software Auto-Configuration</h4>
          <p>Automatically configure TrunkRecorder from your frequencies and talkgroups.</p>
          
          <div id="radio-software-status" style="margin-bottom: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
            <h5>Detection Status</h5>
            <div id="radio-software-status-content">Loading...</div>
          </div>
          
          <div class="form-group" style="margin-bottom: 20px;">
            <button type="button" id="detect-radio-software-btn" class="confirm-btn">Detect Radio Software</button>
            <button type="button" id="configure-trunkrecorder-btn" class="confirm-btn" style="display: none;">Configure TrunkRecorder</button>
          </div>
          
          <div id="trunkrecorder-config-preview" style="display: none; margin-bottom: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
            <h5>Configuration Preview</h5>
            <div id="trunkrecorder-config-preview-content" style="max-height: 300px; overflow-y: auto; background-color: rgba(0, 0, 0, 0.5); padding: 10px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 12px; white-space: pre-wrap; word-wrap: break-word;"></div>
            <div style="margin-top: 15px;">
              <button type="button" id="trunkrecorder-config-save-btn" class="confirm-btn">Save Configuration</button>
              <button type="button" id="trunkrecorder-config-cancel-btn" class="cancel-btn">Cancel</button>
            </div>
          </div>
          
          <div id="trunkrecorder-config-results" style="display: none; margin-top: 15px; padding: 10px; border-radius: 4px;"></div>
        </div>
      </div>
      
      <!-- AI Commands Tab -->
      <div id="quick-start-ai-commands-tab" class="quick-start-tab-content">
        <h3>AI Commands</h3>
        <p class="config-description">Configure radio settings using natural language commands.</p>
        
        <!-- Command Examples -->
        <div class="form-group" style="margin-bottom: 20px;">
          <h4>Example Commands</h4>
          <div id="command-examples-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin-top: 10px;">
            <!-- Examples will be loaded here -->
          </div>
        </div>
        
        <!-- Command Input -->
        <div class="form-group" style="margin-bottom: 20px;">
          <label for="ai-command-input">Enter Command:</label>
          <div style="display: flex; gap: 10px; margin-top: 5px;">
            <input type="text" id="ai-command-input" placeholder="e.g., Add talkgroup 1234 for Fire Department" style="flex: 1; padding: 10px;" />
            <button type="button" id="ai-command-submit-btn" class="confirm-btn">Send</button>
            <button type="button" id="ai-command-voice-btn" class="confirm-btn" title="Voice Input">üé§</button>
          </div>
        </div>
        
        <!-- Command History -->
        <div class="form-group" style="margin-bottom: 20px;">
          <h4>Command History</h4>
          <div id="ai-command-history" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); padding: 10px; background-color: rgba(0, 0, 0, 0.3); border-radius: 4px;">
            <div style="color: #888; font-style: italic;">No commands yet. Try entering a command above.</div>
          </div>
        </div>
        
        <!-- Parsing Results (shown when command is being parsed) -->
        <div id="ai-command-parsing" style="display: none; margin-bottom: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px;">
          <h5>Parsing Command...</h5>
          <div id="ai-command-parsing-result"></div>
        </div>
        
        <!-- Voice Input Feedback -->
        <div id="ai-voice-feedback" style="display: none; margin-bottom: 20px; padding: 15px; border: 2px solid var(--primary-color); border-radius: 4px; text-align: center;">
          <div style="font-size: 24px; margin-bottom: 10px;">üé§</div>
          <div>Listening...</div>
          <div id="ai-voice-status" style="margin-top: 10px; color: #888; font-size: 12px;"></div>
        </div>
      </div>
      
      <!-- Navigation Buttons -->
      <div class="modal-buttons" style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 15px;">
        <button type="button" id="wizard-prev-btn" class="cancel-btn" style="display: none;">‚Üê Previous</button>
        <button type="button" id="wizard-next-btn" class="confirm-btn">Next ‚Üí</button>
        <button type="button" id="wizard-apply-btn" class="confirm-btn" style="display: none;">Apply Configuration</button>
        <button type="button" id="wizard-finish-btn" class="confirm-btn" style="display: none;">Finish</button>
      </div>
    </div>
  </div>
  <!-- END Setup Wizard Modal -->

  <script src="config.js"></script>
  <script src="utils.js"></script>
  <script src="memory.js"></script>
  <script src="errors.js"></script>
  <script src="toast.js"></script>
  <script src="gestures.js"></script>
  <script src="map.js"></script>
  <script src="audio.js"></script>
  <script src="modals.js"></script>
  <script src="api.js"></script>
  <script src="ui.js"></script>
  <script src="app.js?v=3.1.2" defer></script>

  <script>
    // Function to initialize Google Maps
    async function initGoogleMaps() {
      // Wait for the API key to be fetched
      await new Promise((resolve) => {
        const checkKey = () => {
          if (window?.appConfig?.geocoding?.googleApiKey) {
            resolve();
          } else {
            setTimeout(checkKey, 100);
          }
        };
        checkKey();
      });

      const gKey = window.appConfig.geocoding.googleApiKey;
      if (gKey) {
        return new Promise((resolve) => {
          const gScript = document.createElement('script');
          gScript.src = `https://maps.googleapis.com/maps/api/js?key=${gKey}&libraries=places&callback=onGoogleMapsLoaded`;
          gScript.async = true;
          gScript.defer = true;
          window.onGoogleMapsLoaded = () => {
              console.log('Google Maps API loaded successfully');
              resolve();
          };
          document.head.appendChild(gScript);
        });
      } else {
        console.error('Google Maps API key is missing from config.js (appConfig.geocoding.googleApiKey)');
        return Promise.reject('No API key');
      }
    }

    // Start Google Maps loading
    initGoogleMaps().catch(error => {
        console.error('Failed to initialize Google Maps API:', error);
        // Application can potentially continue without maps features, or show an error
    });

    // Placeholder function to close the new modal (will be defined in app.js)
    function closeLiveFeedModal() {
      const modal = document.getElementById('live-feed-modal');
      if (modal) {
          modal.style.display = 'none';
      }
    }
    
    // Placeholder function to close Quick Start modal (will be defined in app.js)
    function closeQuickStartModal() {
      const modal = document.getElementById('quick-start-modal');
      if (modal) {
          modal.style.display = 'none';
      }
    }
  </script>
</body>
</html>
