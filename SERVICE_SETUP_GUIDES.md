# Service Setup Guides

Quick guides for configuring each optional service after installation.

## Ollama - Installing Models

Ollama is used for AI-powered summaries and address extraction.

### After Installation

1. **If installed via Docker:**
   ```bash
   # Pull a model (recommended: llama3.1:8b for good balance)
   docker exec -it ollama ollama pull llama3.1:8b
   
   # Or for smaller/faster (llama3.1:3b)
   docker exec -it ollama ollama pull llama3.1:3b
   
   # Or for better quality (llama3.1:70b - requires more RAM)
   docker exec -it ollama ollama pull llama3.1:70b
   ```

2. **If installed manually:**
   ```bash
   # Pull a model
   ollama pull llama3.1:8b
   ```

### Recommended Models

- **llama3.1:8b** - Best balance (8GB RAM recommended)
- **llama3.1:3b** - Faster, smaller (4GB RAM)
- **llama3.1:70b** - Best quality (64GB+ RAM, GPU recommended)

### Verify Installation

```bash
# List installed models
docker exec -it ollama ollama list

# Test the model
docker exec -it ollama ollama run llama3.1:8b "Hello, world!"
```

### Update Scanner Map .env

Make sure your `.env` has:
```env
AI_PROVIDER=ollama
OLLAMA_URL=http://ollama:11434  # Docker service name
OLLAMA_MODEL=llama3.1:8b
```

---

## iCAD Transcribe - Installing Models

iCAD Transcribe provides advanced radio-optimized transcription.

### After Installation

1. **Access iCAD Web Interface:**
   - Open: http://localhost:9912
   - Default username: `admin`
   - Default password: `changeme123` ⚠️ **CHANGE THIS IMMEDIATELY!**

2. **Install Models via Web Interface:**
   - Log in to iCAD web interface
   - Go to "Models" or "Profiles" section
   - Click "Download Model" or "Add Model"
   - Select a Whisper model:
     - `whisper-1` (base) - Fast, good quality
     - `whisper-1-large` - Better quality, slower
     - `whisper-1-medium` - Balanced

3. **Or via Docker (if supported):**
   ```bash
   # Models are stored in appdata/icad-transcribe/var/
   # Check iCAD documentation for model installation
   ```

### Configure API Key (Auto-Generated)

The installer automatically generates an API key and configures it in:
- Scanner Map `.env`: `ICAD_API_KEY=...`
- iCAD `.env`: Stored in `appdata/icad-transcribe/.env`

**Note:** If you need to regenerate the API key:
1. Generate a new UUID: Use an online UUID generator
2. Update `ICAD_API_KEY` in Scanner Map `.env`
3. Update `API_KEY` in `appdata/icad-transcribe/.env`

### Update Scanner Map .env

Make sure your `.env` has:
```env
TRANSCRIPTION_MODE=icad
ICAD_URL=http://icad-transcribe:9912  # Docker service name
ICAD_PROFILE=whisper-1
ICAD_API_KEY=<auto-generated>  # Already configured by installer
```

### Verify Installation

```bash
# Check iCAD logs
docker-compose logs icad-transcribe

# Test transcription via Scanner Map
# Upload a test audio file through the web interface
```

---

## TrunkRecorder - Setup Requirements

TrunkRecorder records calls from trunked radio systems.

### Hardware Requirements

1. **SDR Device:**
   - RTL-SDR dongle (RTL2832U)
   - HackRF One
   - BladeRF
   - Airspy
   - Other supported SDR devices

2. **USB Access:**
   - SDR device must be accessible to Docker
   - On Linux: Usually works automatically
   - On Windows: May need USB passthrough configuration

### After Installation

1. **Configure Radio System:**
   Edit `appdata/trunk-recorder/config/config.json`:

   ```json
   {
     "sources": [
       {
         "type": "rtl_sdr",
         "device": 0,
         "center": 850000000,
         "rate": 2048000
       }
     ],
     "systems": [
       {
         "id": 1,
         "name": "Your System Name",
         "control_channels": [851.0125, 851.5125],
         "type": "p25"
       }
     ],
     "uploadServer": {
       "type": "rdio-scanner",
       "url": "http://scanner-map:3306/api/call-upload",
       "apiKey": "AUTO_GENERATE_ON_STARTUP"
     }
   }
   ```

2. **Find Your Radio System:**
   - Use RadioReference.com to find control channels
   - Use SDRTrunk or other tools to identify systems
   - Configure `control_channels` with your system's frequencies

3. **API Key (Auto-Generated):**
   - The API key is **automatically generated** on first Scanner Map startup
   - No manual configuration needed!
   - Key is stored in:
     - `appdata/scanner-map/data/apikeys.json`
     - `appdata/trunk-recorder/config/config.json`
     - `appdata/scanner-map/data/trunk-recorder-api-key.txt`

### System Types

- **p25** - P25 Phase 1
- **p25p2** - P25 Phase 2
- **dmr** - DMR
- **nxdn** - NXDN
- **smartnet** - Motorola SmartNet
- **edacs** - EDACS

### Verify Installation

```bash
# Check TrunkRecorder logs
docker-compose logs trunk-recorder

# Check if SDR device is detected
docker exec -it trunk-recorder lsusb

# View recordings
ls appdata/trunk-recorder/recordings/
```

### Troubleshooting

**SDR Not Detected:**
- Check USB permissions (Linux)
- Verify device is connected: `lsusb`
- May need to run with `privileged: true` (already configured)

**No Recordings:**
- Verify control channels are correct
- Check system type matches your radio system
- Ensure Scanner Map is running and accessible

**API Key Issues:**
- API key is auto-generated on first Scanner Map startup
- If issues persist, check `appdata/scanner-map/data/apikeys.json`
- Regenerate: Delete the TrunkRecorder key entry and restart Scanner Map

---

## Quick Reference

### Start All Services
```bash
docker-compose up -d
```

### View Logs
```bash
# All services
docker-compose logs -f

# Specific service
docker-compose logs -f scanner-map
docker-compose logs -f ollama
docker-compose logs -f icad-transcribe
docker-compose logs -f trunk-recorder
```

### Stop All Services
```bash
docker-compose down
```

### Restart a Service
```bash
docker-compose restart scanner-map
docker-compose restart ollama
```

### Check Service Status
```bash
docker-compose ps
```

---

## Next Steps

1. **Configure API Keys:**
   - Add Google Maps or LocationIQ API key to `.env`
   - Add OpenAI API key (if using OpenAI for AI)

2. **Configure Radio System:**
   - Edit TrunkRecorder config (if using)
   - Find control channels for your area

3. **Test Services:**
   - Access Scanner Map: http://localhost:3001
   - Access iCAD: http://localhost:9912
   - Check logs for any errors

4. **Start Using:**
   - Upload audio files manually
   - Or let TrunkRecorder automatically record and upload

